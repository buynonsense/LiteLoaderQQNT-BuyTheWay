# LiteLoaderQQNT-BuyTheWay

[![GitHub release (latest by date)](https://img.shields.io/github/v/release/buynonsense/LiteLoaderQQNT-BuyTheWay?style=flat-square)](https://github.com/buynonsense/LiteLoaderQQNT-BuyTheWay/releases/latest)

一个为 [LiteLoaderQQNT](https://github.com/LiteLoaderQQNT/LiteLoaderQQNT) 开发的插件，用于监控指定QQ群聊中的消息。当消息内容包含预设的关键词时，插件可以将该消息（包括文本和图片）通过QQ或Email转发给指定的用户或群组。

## ✨ 功能特性

*   **群聊监控**: 指定一个或多个QQ群进行消息监控。
*   **关键词匹配**:
    *   设置关注的关键词列表（每行一个）。
    *   匹配时不区分大小写。
    *   **如果关键词列表为空，则监控指定群聊中的所有消息。**
*   **图片消息处理**:
    *   能够捕获消息中的图片内容。
    *   支持将图片作为附件通过邮件发送，并在邮件正文中预览。
    *   支持将图片与文本合并在一条消息中转发给QQ好友和群组。
*   **消息转发**:
    *   转发到指定的QQ好友（文本和图片合并发送）。
    *   转发到指定的QQ群组（文本和图片合并发送）。
    *   通过配置好的SMTP服务器发送邮件通知（文本和图片附件）。
*   **灵活配置**:
    *   **总开关**: 一键启用或禁用整个插件功能。
    *   **注释支持**: 在监控群聊、转发用户、转发群组的ID列表中可以添加中文、英文或符号注释（插件会自动提取数字ID）。
    *   **自动保存**: 设置界面的更改会自动保存，无需手动点击保存按钮。
    *   **导入/导出**: 支持导入和导出关键词、监控群聊、转发用户和转发群组列表，方便备份和分享配置。
    *   **配置管理**: 支持导入和导出所有插件配置到一个 `.json` 文件。
    *   **邮件测试**: 提供测试按钮，验证邮件发送配置是否正确。
    *   **消息输出美化器**: 可选择不同的消息格式模板进行转发。

## 🚀 安装

1.  确保您已安装并启用了 [LiteLoaderQQNT](https://github.com/LiteLoaderQQNT/LiteLoaderQQNT)。（废话）
2.  确保安装了另一插件——**euphony**，它提供了必要的消息监听和发送API支持。（必要）
3.  从 [Releases](https://github.com/Buynonsense/LiteLoaderQQNT-BuyTheWay/releases) 页面下载最新的 source 文件。
4.  将下载的压缩包解压。
5.  登录QQNT使用LiteLoaderQQNT，加载manifest.json文件。
6.  重启QQNT。

## ⚙️ 配置

插件安装并启用后，可以通过 LiteLoaderQQNT 的插件设置菜单访问 \"BuyTheWay\" 的设置界面。

主要配置项说明：

*   **总开关**:
    *   `启用插件`: 勾选此项以启用插件的所有功能。取消勾选则禁用。
*   **配置管理**:
    *   `导出所有配置`: 将当前所有设置导出为一个 JSON 文件。
    *   `导入所有配置`: 从 JSON 文件导入之前保存的设置。
*   **通用设置**:
    *   `关注的商品关键词`: 每行输入一个关键词。如果此列表为空，插件将监控指定群聊中的所有消息。
    *   `监控的群聊列表`: 每行输入一个群号。可以在群号后添加注释，例如 `123456789 (主要监控群)`。插件会自动提取数字部分 `123456789` 作为有效的群ID。
    *   `导入/导出`: 用于导入或导出关键词和监控群聊列表的文本文件。
*   **转发设置**:
    *   `启用转发到QQ用户`: 勾选以启用转发给指定QQ好友的功能。
    *   `转发到QQ用户列表`: 每行输入一个QQ号，同样支持添加注释。
    *   `启用转发到QQ群`: 勾选以启用转发给指定QQ群的功能。
    *   `转发到QQ群列表`: 每行输入一个群号，同样支持添加注释。
    *   `导入/导出`: 用于导入或导出转发用户和转发群组列表的文本文件。
*   **邮件通知设置**:
    *   `启用邮件通知`: 勾选以启用邮件转发功能。
    *   `SMTP服务器地址`, `端口`, `使用SSL/TLS加密`: 填写您的邮箱提供商的SMTP服务器信息。(qq的是 `smtp.qq.com`)
    *   `邮箱账号`, `邮箱密码/授权码`: 用于登录SMTP服务器的凭据。**提示**: QQ邮箱中可以申请授权码：设置→账号→POP3/IMAP/SMTP服务→生成授权码。
    *   `收件人邮箱`: 接收通知邮件的邮箱地址。
    *   `测试发送邮件`: 点击此按钮测试邮件配置是否正确。
*   **消息格式设置**:
    *   `消息格式模板`: 选择转发消息时使用的格式。

所有设置项在修改后会自动保存，无需手动点击保存按钮，他会在LiteLoaderQQNT的data目录下生成一个 `settings.json` 文件，进行持久化存储。

## 📝 使用说明

1.  根据您的需求完成插件配置。
2.  确保插件总开关已启用，并且 **Euphony 插件已正确加载并运行**。
3.  当被监控的群聊中出现新消息时：
    *   如果关键词列表不为空，插件会检查消息内容（包括文本）是否包含任一关键词（不区分大小写）。
    *   如果关键词列表为空，则所有消息都视为匹配。
    *   如果消息匹配成功，插件将根据您的转发设置：
        *   **邮件转发**: 将格式化后的消息文本和图片附件发送到指定邮箱。
        *   **QQ转发**: 将格式化后的消息文本和图片合并为一条消息，发送给指定的QQ用户或QQ群。

## ❓ 故障排查与注意事项

*   **日志查看**: 插件的大部分操作都会在 QQNT 的开发者工具控制台（需要安装另一插件\'Chii DevTools\'）按 `F12` 打开,输出日志在console，日志以 `[BuyTheWay]` 开头。如果遇到问题，请检查console控制台输出。
*   **Euphony 依赖**: 本插件的核心消息监听和QQ转发功能**强依赖** `euphony` 插件。请确保 `euphony` 插件已正确安装、启用，并且版本兼容。如果 `euphony` 未能正常工作，本插件的消息捕获和QQ转发功能将无法使用。
*   **图片路径**: 插件通过 Euphony 获取图片在您本地的缓存路径。请确保 QQNT 有权限访问这些路径。
*   **邮件发送失败**:
    *   仔细检查 SMTP 服务器地址、端口、加密方式、账号和密码/授权码是否正确。
    *   确认您的邮箱账号已开启SMTP服务。
    *   部分邮箱服务商可能会阻止来自未知应用的登录，请查阅邮箱服务商的帮助文档，了解是否需要生成应用专用密码或授权码。
    *   检查网络连接和防火墙设置。
*   **QQ转发失败**:
    *   除了依赖 Euphony 外，QQ转发功能也可能受到 QQ 版本更新的影响。
    *   检查控制台是否有 Euphony 相关的错误日志。
*   **配置丢失**: 插件配置保存在 LiteLoaderQQNT 数据目录下的 `plugins/LiteLoaderQQNT-BuyTheWay/data/settings.json` 文件中。请确保 LiteLoaderQQNT 对该文件有读写权限。

## 📄 许可证

[MIT](./LICENSE)